{{- if eq .chezmoi.os "linux" -}}
#!/usr/bin/env bash

set -e

# Prevent interactive prompts during package installation
export DEBIAN_FRONTEND=noninteractive

echo "Installing packages for Linux..."

# Update package lists
sudo apt update

# Install essential packages
sudo apt-get install -y \
  software-properties-common \
  git \
  curl \
  wget \
  build-essential \
  zsh \
  fd-find \
  ripgrep \
  bat \
  jq \
  gpg

# Install neovim (using latest stable from PPA)
sudo DEBIAN_FRONTEND=noninteractive add-apt-repository -y ppa:neovim-ppa/stable
sudo apt-get update
sudo DEBIAN_FRONTEND=noninteractive apt-get install -y neovim

# Install fzf
if [ ! -d "$HOME/.fzf" ]; then
  git clone --depth 1 https://github.com/junegunn/fzf.git "$HOME/.fzf"
  "$HOME/.fzf/install" --all --no-bash --no-fish --xdg
fi

# Install gh (GitHub CLI)
if ! command -v gh &>/dev/null; then
  (type -p wget >/dev/null || (sudo apt update && sudo apt-get install wget -y)) &&
    sudo mkdir -p -m 755 /etc/apt/keyrings &&
    wget -qO- https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo tee /etc/apt/keyrings/githubcli-archive-keyring.gpg >/dev/null &&
    sudo chmod go+r /etc/apt/keyrings/githubcli-archive-keyring.gpg &&
    echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list >/dev/null &&
    sudo apt update &&
    sudo apt install gh -y
fi

# Install mise (formerly rtx)
if ! command -v mise &>/dev/null; then
  curl https://mise.run | sh
fi

# Install vivid (LS_COLORS generator) - build from source since it's not in apt
if ! command -v vivid &>/dev/null; then
  if ! command -v cargo &>/dev/null; then
    echo "Skipping vivid installation (requires Rust/cargo)"
  else
    cargo install vivid
  fi
fi

# Create symbolic links for fd-find and batcat (Ubuntu uses different names)
if [ -f /usr/bin/fd-find ] && [ ! -f "$HOME/.local/bin/fd" ]; then
  mkdir -p "$HOME/.local/bin"
  ln -s /usr/bin/fd-find "$HOME/.local/bin/fd"
fi

if [ -f /usr/bin/batcat ] && [ ! -f "$HOME/.local/bin/bat" ]; then
  mkdir -p "$HOME/.local/bin"
  ln -s /usr/bin/batcat "$HOME/.local/bin/bat"
fi

echo "Linux package installation complete!"
{{ end -}}
