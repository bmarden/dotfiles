#
# .zshrc
#

# Use zim's degit tool to install modules
zstyle ':zim:zmodule' use 'degit'

# Set dependant variables
ZIM_HOME="${HOME}/.zim"
ZSH_EXTRAS="${HOME}/.zsh"

# Download zimfw plugin manager if missing.
if [[ ! -e ${ZIM_HOME}/zimfw.zsh ]]; then
  curl -fsSL --create-dirs -o ${ZIM_HOME}/zimfw.zsh \
    https://github.com/zimfw/zimfw/releases/latest/download/zimfw.zsh
fi

# Install missing modules, and update ${ZIM_HOME}/init.zsh if missing or outdated.
if [[ ! ${ZIM_HOME}/init.zsh -nt ${ZDOTDIR:-${HOME}}/.zimrc ]]; then
  source ${ZIM_HOME}/zimfw.zsh init -q
fi

# Activate Powerlevel10k Instant Prompt.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Initialize modules.
source ${ZIM_HOME}/init.zsh

[[ -f $HOME/.p10k.zsh ]] && source $HOME/.p10k.zsh

# # Set history here since MacOS sets them in /etc/zshrc
HISTFILE="$ZSH_EXTRAS/.zsh_history"

# try to make the completion list smaller (occupying less lines) by printing the matches in columns with different widths.
setopt list_packed
# share history across multiple zsh sessions
setopt append_history
# add more data to history file 
setopt extended_history
# adds commands as they are typed, not at shell exit
setopt inc_append_history
# don't try to correct command line spelling for command args
unsetopt correctall

autoload -Uz zcalc colors

# Not sure if this asdf script is needed in addition to zim asdf module
[ -n "$(command -v asdf)" ] && source "$(brew --prefix asdf)/libexec/asdf.sh"
# Use vivid to generate a themed LS_COLORS
[ -n "$(command -v vivid)" ] && export LS_COLORS="$(vivid generate molokai)"
# Load 1password completions
[ -n "$(command -v op)" ] && eval "$(op completion zsh)" && compdef _op op
# Load dotnet env vars if installed - commented out since dotnet not installed via asdf currently 
[[ -n "$(command -v dotnet)" ]] && [[ "$(command -v dotnet)" == *"asdf"* ]] && source "$HOME/.asdf/plugins/dotnet/set-dotnet-env.zsh"

zstyle ':completion:*:*:kill:*' menu yes select
zstyle ':completion:*:kill:*'   force-list always
zstyle ":completion:*:descriptions" format "%B%d%b"
zstyle ':completion:*:*:*:default' menu yes select search
zstyle ':completion:*:*:*:default' menu yes select
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Za-z}'
zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}

# Load shell settings
if [ -d "$ZSH_EXTRAS/" ]; then
  for file in "$ZSH_EXTRAS"/*.zsh; do
    source "$file"
  done
fi

# # Load custom functions into fpath
fpath=("$ZSH_EXTRAS/functions" "${fpath[@]}")
autoload -Uz "$ZSH_EXTRAS"/functions/*
